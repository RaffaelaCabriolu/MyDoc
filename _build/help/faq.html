

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frequently asked questions &mdash; HPC Physics documentation 0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Forum, Open Question &amp; Answer Sessions" href="hpc-qa-sessions.html" />
    <link rel="prev" title="Tutorials" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> HPC Physics documentation
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../clusters/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/news.html">News and notifications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="staff.html">Support staff and Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently asked questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#passwords">Passwords</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-forgot-my-password-what-now">I forgot my password - what now?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-change-my-password">How do I change my password ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-the-ssh-key-fingerprint-for-the-resources">What is the ssh key fingerprint for the resources?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-software">Installing software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-need-python-package-x-but-the-one-on-the-resource-i-am-using-is-too-old-or-i-cannot-find-it">I need Python package X but the one on the resource I am using is too old or I cannot find it</a></li>
<li class="toctree-l3"><a class="reference internal" href="#can-i-install-some-software-as-a-normal-user-without-sudo-rights">Can I install some software as a normal user without sudo rights?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compute-and-storage-quota">Compute and storage quota</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-check-my-disk-quota-and-disk-usage">How can I check my disk quota and disk usage?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#connecting-via-ssh">Connecting via ssh</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-export-the-display-from-a-compute-node-to-my-desktop">How can I export the display from a compute node to my desktop?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-access-a-compute-node-from-the-login-node">How can I access a compute node from the login node?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#my-ssh-connections-are-dying-freezing">My ssh connections are dying / freezing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jobs-and-queue-system">Jobs and queue system</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-am-not-able-to-submit-jobs-longer-than-a-certain-number-of-hours">I am not able to submit jobs longer than a certain number of hours.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#where-can-i-find-an-example-of-job-script">Where can I find an example of job script?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-will-my-job-start">When will my job start?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-see-the-queing-situation">How can I see the queing situation?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-does-my-job-not-start-or-give-me-error-feedback-when-submitting">Why does my job not start or give me error feedback when submitting?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-is-my-job-not-starting-on-highmem-nodes-although-the-highmem-queue-is-empty">Why is my job not starting on highmem nodes although the highmem queue is empty?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-run-many-short-tasks">How can I run many short tasks?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hpc-qa-sessions.html">Forum, Open Question &amp; Answer Sessions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jobs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../jobs/dos_and_donts.html">Dos and don’ts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/batch.html">Batch system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/examples.html">Job script examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../jobs/slurm_parameter.html">SLURM Workload Manager</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../jobs/job_management.html">Managing jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/monitoring.html">Monitoring your jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/running_mpi_jobs.html">Running MPI jobs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HPC Physics documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Frequently asked questions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/help/faq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="frequently-asked-questions">
<h1>Frequently asked questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<section id="passwords">
<h2>Passwords<a class="headerlink" href="#passwords" title="Permalink to this headline">¶</a></h2>
<section id="i-forgot-my-password-what-now">
<h3>I forgot my password - what now?<a class="headerlink" href="#i-forgot-my-password-what-now" title="Permalink to this headline">¶</a></h3>
<p>To reset your password, get in contact with the support relative to the resource.</p>
</section>
<section id="how-do-i-change-my-password">
<h3>How do I change my password ?<a class="headerlink" href="#how-do-i-change-my-password" title="Permalink to this headline">¶</a></h3>
</section>
<section id="what-is-the-ssh-key-fingerprint-for-the-resources">
<h3>What is the ssh key fingerprint for the resources?<a class="headerlink" href="#what-is-the-ssh-key-fingerprint-for-the-resources" title="Permalink to this headline">¶</a></h3>
</section>
</section>
<section id="installing-software">
<h2>Installing software<a class="headerlink" href="#installing-software" title="Permalink to this headline">¶</a></h2>
<section id="i-need-python-package-x-but-the-one-on-the-resource-i-am-using-is-too-old-or-i-cannot-find-it">
<h3>I need Python package X but the one on the resource I am using is too old or I cannot find it<a class="headerlink" href="#i-need-python-package-x-but-the-one-on-the-resource-i-am-using-is-too-old-or-i-cannot-find-it" title="Permalink to this headline">¶</a></h3>
<p>You can choose different Python versions with either the module system or using Anaconda/Miniconda. See here: <a class="reference internal" href="../software/modules.html"><span class="doc">Software Module Scheme</span></a> and <a class="reference internal" href="../software/python_r_perl.html"><span class="doc">Python, R, Matlab and Perl</span></a>.</p>
<p>In cases where this still doesn’t solve your problem or you would like to install a package yourself, please read the next section below about installing without sudo rights.</p>
<p>If we don’t have it installed, and installing it yourself is not a good solution for you, please contact us and we will do our best to help you.</p>
</section>
<section id="can-i-install-some-software-as-a-normal-user-without-sudo-rights">
<h3>Can I install some software as a normal user without sudo rights?<a class="headerlink" href="#can-i-install-some-software-as-a-normal-user-without-sudo-rights" title="Permalink to this headline">¶</a></h3>
</section>
</section>
<section id="compute-and-storage-quota">
<h2>Compute and storage quota<a class="headerlink" href="#compute-and-storage-quota" title="Permalink to this headline">¶</a></h2>
<section id="how-can-i-check-my-disk-quota-and-disk-usage">
<h3>How can I check my disk quota and disk usage?<a class="headerlink" href="#how-can-i-check-my-disk-quota-and-disk-usage" title="Permalink to this headline">¶</a></h3>
<p>To check how large your disk quota is, and how much of it you have used,
you can use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ quota -s
</pre></div>
</div>
<p>Only home and project partitions have quota.</p>
</section>
</section>
<section id="connecting-via-ssh">
<h2>Connecting via ssh<a class="headerlink" href="#connecting-via-ssh" title="Permalink to this headline">¶</a></h2>
<section id="how-can-i-export-the-display-from-a-compute-node-to-my-desktop">
<h3>How can I export the display from a compute node to my desktop?<a class="headerlink" href="#how-can-i-export-the-display-from-a-compute-node-to-my-desktop" title="Permalink to this headline">¶</a></h3>
<p>If you need to export the display from a compute node to your desktop you should</p>
<ol class="arabic simple">
<li><p>First login to your resource with display forwarding.</p></li>
<li><p>Then you should reserve a node, with display forwarding, trough the
queuing system.</p></li>
</ol>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -Y                               # log in with port forwarding
$ srun -N 1 -t 1:0:0 --pty bash -I     # reserve and log in on a compute node
</pre></div>
</div>
<p>This example assumes that you are running an X-server on your local
desktop, which should be available for most users running Linux, Unix
and Mac Os X. If you are using Windows you must install some X-server
on your local PC.</p>
</section>
<section id="how-can-i-access-a-compute-node-from-the-login-node">
<h3>How can I access a compute node from the login node?<a class="headerlink" href="#how-can-i-access-a-compute-node-from-the-login-node" title="Permalink to this headline">¶</a></h3>
<p>Is the following useful?</p>
<p>Log in to the resource and type e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh compute-1
</pre></div>
</div>
<p>or use the shorter version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh c1
</pre></div>
</div>
</section>
<section id="my-ssh-connections-are-dying-freezing">
<h3>My ssh connections are dying / freezing<a class="headerlink" href="#my-ssh-connections-are-dying-freezing" title="Permalink to this headline">¶</a></h3>
<p>How to prevent your ssh connections from dying / freezing.</p>
<p>If your ssh connections more or less randomly are dying / freezing, try
to add the following to your <em>local</em> <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ServerAliveCountMax</span> <span class="mi">3</span>
<span class="n">ServerAliveInterval</span> <span class="mi">10</span>
</pre></div>
</div>
<p>(<em>local</em> means that you need to make these changes to your computer,
not on HPC)</p>
<p>The above config is for <a class="reference external" href="https://www.openssh.org">OpenSSH</a>, if you’re
using
<a class="reference external" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html">PUTTY</a>
you can take a look at this page explaining
<a class="reference external" href="https://the.earth.li/~sgtatham/putty/0.60/htmldoc/Chapter4.html#config-keepalive">keepalives</a>
for a similar solution.</p>
</section>
</section>
<section id="jobs-and-queue-system">
<h2>Jobs and queue system<a class="headerlink" href="#jobs-and-queue-system" title="Permalink to this headline">¶</a></h2>
<section id="i-am-not-able-to-submit-jobs-longer-than-a-certain-number-of-hours">
<h3>I am not able to submit jobs longer than a certain number of hours.<a class="headerlink" href="#i-am-not-able-to-submit-jobs-longer-than-a-certain-number-of-hours" title="Permalink to this headline">¶</a></h3>
<p>Please read about <a class="reference internal" href="../clusters/hpc.html#partitions"><span class="std std-ref">Partitions</span></a>.</p>
</section>
<section id="where-can-i-find-an-example-of-job-script">
<h3>Where can I find an example of job script?<a class="headerlink" href="#where-can-i-find-an-example-of-job-script" title="Permalink to this headline">¶</a></h3>
<p>You can find job script examples in <a class="reference internal" href="../jobs/examples.html#job-script-examples"><span class="std std-ref">Job script examples</span></a>.</p>
<p>Do we need the following description?:</p>
<p>Relevant application specific examples (also for beginning users) for a few applications can be found in <a class="reference internal" href="../applications/sw_guides.html#sw-guides"><span class="std std-ref">Application guides</span></a>.</p>
</section>
<section id="when-will-my-job-start">
<h3>When will my job start?<a class="headerlink" href="#when-will-my-job-start" title="Permalink to this headline">¶</a></h3>
<p>How can I find out when my job will start?</p>
<p>To find out approximately when the job scheduler thinks your job will
start, use the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">squeue</span> <span class="o">--</span><span class="n">start</span> <span class="o">-</span><span class="n">j</span> <span class="o">&lt;</span><span class="n">job_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This command will give you information about how many nodes your job requires,
as well as when approximately it will start and complete.  It
must be emphasized that this is just a best guess, queued jobs may start
earlier because of running jobs that finishes before they hit the walltime
limit and jobs may start later than projected because new jobs are submitted
that get higher priority.</p>
</section>
<section id="how-can-i-see-the-queing-situation">
<h3>How can I see the queing situation?<a class="headerlink" href="#how-can-i-see-the-queing-situation" title="Permalink to this headline">¶</a></h3>
<p>How can I see how my jobs are doing in the queue, if my jobs are idle, blocked,
running?</p>
<p>On the webpage you
can find information about the current load on , some information about
the nodes, and the information you would get from the showq command, which is
described below. You can also find information about your job and if you the
job is running, you can find graphs about its usage of the CPUs, memory and so
on.</p>
<p>If you prefer to use the command line, to see the job queue use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ squeue
</pre></div>
</div>
</section>
<section id="why-does-my-job-not-start-or-give-me-error-feedback-when-submitting">
<h3>Why does my job not start or give me error feedback when submitting?<a class="headerlink" href="#why-does-my-job-not-start-or-give-me-error-feedback-when-submitting" title="Permalink to this headline">¶</a></h3>
<p>Most often the reason a job is not starting is that the resources are occupied at the moment and there are many jobs waiting in the queue. But sometimes there is an error in the job script and you are asking for a configuration that is not possible on the HPC. In such a case the job will not start.</p>
<p>To find out how to monitor your jobs and check their status see <a class="reference internal" href="../jobs/monitoring.html#monitoring-jobs"><span class="std std-ref">Monitoring your jobs</span></a>.</p>
<p>Below are a few cases of why jobs don’t start or error messages you might get:</p>
<p><strong>Memory per core</strong></p>
<blockquote>
<div><p>“When I try to start a job with 2GB of memory pr. core, I get the following error:
<code class="docutils literal notranslate"><span class="pre">sbatch:</span> <span class="pre">error:</span> <span class="pre">Batch</span> <span class="pre">job</span> <span class="pre">submission</span> <span class="pre">failed:</span> <span class="pre">Requested</span> <span class="pre">node</span> <span class="pre">configuration</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">available</span></code>
With 1GB/core it works fine. What might be the cause to this?”</p>
</div></blockquote>
<p>On the HPC have different configurations available; 16 core and 20 core nodes - with both a
total of 32 GB of memory/node. If you ask for full nodes by
specifying both number of nodes and cores/node together with 2 GB of memory/core, you will ask
for 20 cores/node and 40 GB of memory. This configuration does not exist on the HPC. If you ask for 16 cores, still with 2GB/core, there is a sort of buffer within SLURM no allowing you
to consume absolutely all memory available (system needs some to work). 2000MB/core works
fine, but not 2 GB for 16 cores/node.</p>
<p>The solution we want to push in general is this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH -ntasks=80 # (number of nodes * number of cores, i.e. 5*16 or 4*20 = 80)</span>
</pre></div>
</div>
<p>If you then ask for 2000MB of memory/core, you will be given 16 cores/node and a total
of 16 nodes. 4000MB will give you 8 cores/node - everyone being happy. Just note the
info about PE <a class="reference internal" href="../jobs/slurm_parameter.html#accounting"><span class="std std-ref">Accounting</span></a>; mem-per-cpu 4000MB will cost you twice as much as
mem-per-cpu 2000MB.</p>
<p>Please also note that if you want to use the whole memory on a node, do not ask
for 32GB, but for 31GB or 31000MB as the node needs some memory for the system itself.
For an example, see here: <a class="reference internal" href="../jobs/examples.html#allocated-entire-memory"><span class="std std-ref">Example on how to allocate entire memory on one node</span></a></p>
<p><strong>Step memory limit</strong></p>
<blockquote>
<div><p>“Why do I get <code class="docutils literal notranslate"><span class="pre">slurmstepd:</span> <span class="pre">Exceeded</span> <span class="pre">step</span> <span class="pre">memory</span> <span class="pre">limit</span></code> in my log/output?”</p>
</div></blockquote>
<p>For slurm, the memory flag is a hard limit, meaning that when each core
tries to utilize more than the given amount of memory, it is killed by the slurm-deamon.
For example <code class="docutils literal notranslate"><span class="pre">$SBATCH</span> <span class="pre">--mem-per-cpu=2GB</span></code> means that you maximum can use 2 GB of memory per
core. With memory intensive applications like Comsol or VASP, your job will likely be
terminated. The solution to this problem is to specify the
number of tasks irrespectively of cores/node and ask for as much memory you will need.</p>
<p>For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --ntasks=20</span>
<span class="c1">#SBATCH --time=0-24:05:00</span>
<span class="c1">#SBATCH --mem-per-cpu=6000MB</span>
</pre></div>
</div>
<p><strong>QOSMaxWallDurationPerJobLimit</strong></p>
<p>QOSMaxWallDurationPerJobLimit means that MaxWallDurationPerJobLimit has been exceeded. Basically, you have asked for more time than allowed for the given QOS/Partition. Please have a look at <a class="reference internal" href="../clusters/hpc.html#partitions"><span class="std std-ref">Partitions</span></a></p>
<p><strong>Priority vs. Resources</strong></p>
<p>“Priority” means that resources are in principle available, but someone else has higher priority in the queue, i.e. the PoreLab members have priorities in their partitions.
“Resources” means the at the moment the requested resources are not available.</p>
</section>
<section id="why-is-my-job-not-starting-on-highmem-nodes-although-the-highmem-queue-is-empty">
<h3>Why is my job not starting on highmem nodes although the highmem queue is empty?<a class="headerlink" href="#why-is-my-job-not-starting-on-highmem-nodes-although-the-highmem-queue-is-empty" title="Permalink to this headline">¶</a></h3>
<p>To prevent the highmem nodes from standing around idle, normal jobs may use them as well, using only 32 GB of the available memory. Hence, it is possible that the highmem nodes are busy, although you do not see any jobs queuing or running on <cite>squeue -p highmem</cite>.</p>
</section>
<section id="how-can-i-run-many-short-tasks">
<h3>How can I run many short tasks?<a class="headerlink" href="#how-can-i-run-many-short-tasks" title="Permalink to this headline">¶</a></h3>
<p>The overhead in the job start and cleanup makes it unpractical to run
thousands of short tasks as individual jobs on HPC.</p>
<p>The queueing setup, or rather, the accounting system generates
overhead in the start and finish of a job of about 1 second at each end
of the job. This overhead is insignificant when running large parallel
jobs, but creates scaling issues when running a massive amount of
shorter jobs. One can consider a collection of independent tasks as one
large parallel job and the aforementioned overhead becomes the serial or
unparallelizable part of the job. This is because the queuing system can
only start and account one job at a time. This scaling problem is
described by <a class="reference external" href="https://en.wikipedia.org/wiki/Amdahl's_law">Amdahls Law</a>.</p>
<p>If the tasks are extremly short, you can use the example below. If you want to
spawn many jobs without polluting the queueing system, please have a look at
<a class="reference internal" href="../jobs/examples.html#job-arrays"><span class="std std-ref">Running many sequential jobs in parallel using job arrays</span></a>.</p>
<p>By using some shell trickery one can spawn and load-balance multiple
independent task running in parallel within one node, just background
the tasks and poll to see when some task is finished until you spawn the
next:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># Jobscript example that can run several tasks in parallel.</span>
<span class="c1"># All features used here are standard in bash so it should work on</span>
<span class="c1"># any sane UNIX/LINUX system.</span>
<span class="c1"># Author: roy.dragseth@uit.no</span>
<span class="c1">#</span>
<span class="c1"># This example will only work within one compute node so let&#39;s run</span>
<span class="c1"># on one node using all the cpu-cores:</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=20</span>

<span class="c1"># We assume we will (in total) be done in 10 minutes:</span>
<span class="c1">#SBATCH --time=0-00:10:00</span>

<span class="c1"># Let us use all CPUs:</span>
<span class="nv">maxpartasks</span><span class="o">=</span><span class="nv">$SLURM_TASKS_PER_NODE</span>

<span class="c1"># Let&#39;s assume we have a bunch of tasks we want to perform.</span>
<span class="c1"># Each task is done in the form of a shell script with a numerical argument:</span>
<span class="c1"># dowork.sh N</span>
<span class="c1"># Let&#39;s just create some fake arguments with a sequence of numbers</span>
<span class="c1"># from 1 to 100, edit this to your liking:</span>
<span class="nv">tasks</span><span class="o">=</span><span class="k">$(</span>seq <span class="m">100</span><span class="k">)</span>

<span class="nb">cd</span> <span class="nv">$SLURM_SUBMIT_DIR</span>

<span class="k">for</span> t <span class="k">in</span> <span class="nv">$tasks</span><span class="p">;</span> <span class="k">do</span>
  <span class="c1"># Do the real work, edit this section to your liking.</span>
  <span class="c1"># remember to background the task or else we will</span>
  <span class="c1"># run serially</span>
  ./dowork.sh <span class="nv">$t</span> <span class="p">&amp;</span>

  <span class="c1"># You should leave the rest alone...</span>

  <span class="c1"># count the number of background tasks we have spawned</span>
  <span class="c1"># the jobs command print one line per task running so we only need</span>
  <span class="c1"># to count the number of lines.</span>
  <span class="nv">activetasks</span><span class="o">=</span><span class="k">$(</span><span class="nb">jobs</span> <span class="p">|</span> wc -l<span class="k">)</span>

  <span class="c1"># if we have filled all the available cpu-cores with work we poll</span>
  <span class="c1"># every second to wait for tasks to exit.</span>
  <span class="k">while</span> <span class="o">[</span> <span class="nv">$activetasks</span> -ge <span class="nv">$maxpartasks</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
    sleep <span class="m">1</span>
    <span class="nv">activetasks</span><span class="o">=</span><span class="k">$(</span><span class="nb">jobs</span> <span class="p">|</span> wc -l<span class="k">)</span>
  <span class="k">done</span>
<span class="k">done</span>

<span class="c1"># Ok, all tasks spawned. Now we need to wait for the last ones to</span>
<span class="c1"># be finished before we exit.</span>
<span class="nb">echo</span> <span class="s2">&quot;Waiting for tasks to complete&quot;</span>
<span class="nb">wait</span>
<span class="nb">echo</span> <span class="s2">&quot;done&quot;</span>
</pre></div>
</div>
<p>And here is the <code class="docutils literal notranslate"><span class="pre">dowork.sh</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># Fake some work, $1 is the task number.</span>
<span class="c1"># Change this to whatever you want to have done.</span>

<span class="c1"># sleep between 0 and 10 secs</span>
<span class="nb">let</span> <span class="nv">sleeptime</span><span class="o">=</span><span class="m">10</span>*<span class="nv">$RANDOM</span>/32768

<span class="nb">echo</span> <span class="s2">&quot;Task </span><span class="nv">$1</span><span class="s2"> is sleeping for </span><span class="nv">$sleeptime</span><span class="s2"> seconds&quot;</span>
sleep <span class="nv">$sleeptime</span>
<span class="nb">echo</span> <span class="s2">&quot;Task </span><span class="nv">$1</span><span class="s2"> has slept for </span><span class="nv">$sleeptime</span><span class="s2"> seconds&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hpc-qa-sessions.html" class="btn btn-neutral float-right" title="Forum, Open Question &amp; Answer Sessions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, HPC Physics group - NTNU

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>